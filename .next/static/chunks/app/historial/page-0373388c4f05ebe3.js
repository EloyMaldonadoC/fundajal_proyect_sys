(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3764],{4112:function(a,e,o){Promise.resolve().then(o.bind(o,9497))},9497:function(a,e,o){"use strict";o.r(e),o.d(e,{default:function(){return C}});var r=o(7437),i=o(2265),s=o(3431),t=o.n(s),n=o(7648),l=o(4868),c=o(8072),d=o(8999),_=o.n(d),u=o(6806),h=o(56),x=o.n(h),m=function(a){let{historial:e}=a;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:x().header,children:(0,r.jsx)("h3",{children:"Historial de entradas y salidad de productos"})}),(0,r.jsxs)("div",{className:x().titulo,children:[(0,r.jsx)("h4",{className:x().nombre,children:"Producto"}),(0,r.jsx)("h4",{className:x().estado,children:"Estado"}),(0,r.jsx)("h4",{className:x().motivo,children:"Motivo"}),(0,r.jsx)("h4",{className:x().cantidad,children:"Cant"}),(0,r.jsx)("h4",{className:x().fecha,children:"D\xeda"}),(0,r.jsx)("h4",{className:x().hora,children:"Hora"})]}),e.map((a,e)=>(0,r.jsxs)("div",{className:x().container,children:[(0,r.jsx)("div",{className:x().nombre,children:a.produc_nombre}),(0,r.jsx)("div",{className:x().estado,children:"salida"==a.hist_estado?(0,r.jsx)(_(),{name:"caret-up-outline",className:x().rojo}):(0,r.jsx)(_(),{name:"caret-down-outline",className:x().verde})}),(0,r.jsx)("div",{className:x().motivo,children:a.hist_motivo}),(0,r.jsx)("div",{className:x().cantidad,children:a.hist_cantidad}),(0,r.jsx)("div",{className:x().fecha,children:(0,u.ji)(a.hist_dia)}),(0,r.jsx)("div",{className:x().hora,children:a.hist_hora})]},e)),(0,r.jsx)("div",{className:x().fooder})]})},j=o(6188),p=o.n(j),v=o(8224),b=o.n(v),f=function(a){let{proveedores:e}=a;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:b().header,children:(0,r.jsx)("h3",{children:"Proveedores"})}),(0,r.jsxs)("div",{className:b().titulo,children:[(0,r.jsx)("h4",{className:b().nombre,children:"Nombre"}),(0,r.jsx)("h4",{className:b().telefono,children:"Telefono"}),(0,r.jsx)("h4",{className:b().direccion,children:"Direcci\xf3n"}),(0,r.jsx)("h4",{className:b().rfc,children:"RFC"})]}),0!=e.length&&(0,r.jsx)(r.Fragment,{children:e.map((a,e)=>(0,r.jsxs)("div",{className:b().container,children:[(0,r.jsx)("div",{className:b().nombre,children:a.prov_nombre}),(0,r.jsx)("div",{className:b().telefono,children:a.prov_numero_cont}),(0,r.jsxs)("div",{className:b().direccion,children:[a.prov_direccion,", ",a.prov_municipio,", ",a.prov_estado]}),(0,r.jsx)("div",{className:b().rfc,children:a.prov_rfc})]},e))}),(0,r.jsx)("div",{className:b().fooder})]})},g=o(9172);function N(a){let{producto:e}=a,[o,s]=(0,i.useState)(!1),[t,n]=(0,i.useState)([]),[l,c]=(0,i.useState)([]),[d,_]=(0,i.useState)(1),h=()=>{fetch("/api/historial/inventario/".concat(e.produc_id)).then(a=>{if(!a.ok)throw Error("Error al cargar historial");return a.json()}).then(a=>{console.log(a),n(a.historial),c(a.proveedores)}).catch(a=>{console.log(a)})},x=a=>{_(a)},j=20*d;t.slice(j-20,j);let v=Math.ceil(t.length/20);return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"\n          ".concat(p().container," \n          ").concat(o?p().desplegado:"","\n        "),onClick:()=>{s(!o),o||0!=t.length||h()},children:[(0,r.jsx)("div",{className:p().nombre,children:o?(0,r.jsx)("h3",{children:e.produc_nombre}):(0,r.jsx)("p",{children:e.produc_nombre})}),(0,r.jsx)("div",{className:p().cantidad,children:o?(0,r.jsx)("h3",{children:e.produc_existencias}):(0,r.jsx)("p",{children:e.produc_existencias})}),(0,r.jsx)("div",{className:p().precio,children:o?(0,r.jsx)("h3",{children:(0,u.uf)(e.produc_precio_venta)}):(0,r.jsx)("p",{children:(0,u.uf)(e.produc_precio_venta)})}),(0,r.jsx)("div",{className:p().participacion,children:o?(0,r.jsx)("h3",{children:(0,u.uf)(e.produc_parti_fun)}):(0,r.jsx)("p",{children:(0,u.uf)(e.produc_parti_fun)})}),(0,r.jsx)("div",{className:p().participacion,children:o?(0,r.jsx)("h3",{children:(0,u.uf)(e.produc_parti_enlace)}):(0,r.jsx)("p",{children:(0,u.uf)(e.produc_parti_enlace)})}),o&&(0,r.jsxs)("div",{className:p().contenedorHistorial,children:[(0,r.jsx)(m,{historial:t}),[...Array(v).keys()].map(a=>(0,r.jsx)("button",{className:"".concat(p().button," ").concat(a+1===d?p().disabled:p().enabled),onClick:()=>x(a+1),disabled:a+1===d,children:a+1},a)),(0,r.jsx)(f,{proveedores:l})]})]})})}var T=function(){let[a,e]=(0,i.useState)([]),[o,s]=(0,i.useState)(0),[t,n]=(0,i.useState)(0),[c,d]=(0,i.useState)(0),[_,h]=(0,i.useState)(""),[x,m]=(0,i.useState)(!1),[j,v]=(0,i.useState)(!1),[b,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{fetch("/api/productos").then(a=>{if(!a.ok)throw Error("Error al cargar productos");return a.json()}).then(a=>{console.log(a),e(a)}).catch(a=>{console.log(a)})},[b]);let T=async()=>{let e=new Date,r=a.find(a=>a.produc_id==t),i=r.produc_existencias-_;await fetch("/api/productos/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({produc_existencias:i})}).then(a=>{if(!a.ok)throw Error("Error al actualizar producto");return a.json()}).catch(a=>{console.log(a)}),await fetch("/api/inventario/historial",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({produc_id:t,hist_estado:"salida",hist_cantidad:_,hist_precio_ent_sal:r.produc_precio_venta,hist_motivo:1==o?"venta individual":2==o?"da\xf1ado":"no encontrado",hist_dia:e.toISOString().split("T")[0],hist_hora:(0,u.P4)()})}).then(a=>{if(!a.ok)throw Error("Error al generar historial");return a.json()}).catch(a=>{console.log(a)}),s(0),n(0),h(0),m(!1),v(!1),f(!b)};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:p().herramientas,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{children:"Seleccionar opci\xf3n: "}),(0,r.jsxs)("select",{className:p().select,value:o,onChange:a=>{s(a.target.value),console.log(a.target.value)},children:[(0,r.jsx)("option",{value:0,children:"--Seleccionar--"}),(0,r.jsx)("option",{value:1,children:"venta individual"}),(0,r.jsx)("option",{value:2,children:"da\xf1ado"}),(0,r.jsx)("option",{value:3,children:"no encontrado"})]}),(0,r.jsx)("label",{children:"Seleccionar producto: "}),(0,r.jsxs)("select",{className:p().select,value:t,onChange:e=>{n(e.target.value),d(a.find(a=>a.produc_id==e.target.value).produc_existencias)},children:[(0,r.jsx)("option",{value:0,children:"--Seleccionar--"}),a.map((a,e)=>(0,r.jsx)("option",{value:a.produc_id,children:a.produc_nombre},e))]}),(0,r.jsx)("input",{className:p().input,type:"number",placeholder:"Cantidad",value:_,onChange:a=>{h(a.target.value)},min:0,max:c,disabled:0==t})]}),(0,r.jsx)("div",{children:(0,r.jsx)(l.zx,{text:"Aceptar",disabled:0==o||0==t||0==_,type:0==o||0==t||0==_?"":"cancelar",onPress:()=>{m(!0)}})})]}),(0,r.jsx)("div",{className:p().header,children:(0,r.jsx)("h3",{children:"Historial de productos"})}),(0,r.jsxs)("div",{className:p().titulo,children:[(0,r.jsx)("h4",{className:p().nombre,children:"Producto"}),(0,r.jsx)("h4",{className:p().cantidad,children:"Cantidad"}),(0,r.jsx)("h4",{className:p().precio,children:"Precio"}),(0,r.jsx)("h4",{className:p().participacion,children:"Participaci\xf3n Fundaci\xf3n"}),(0,r.jsx)("h4",{className:p().participacion,children:"Participaci\xf3n Enlace"})]}),0!=a.length&&(0,r.jsx)(r.Fragment,{children:a.map((a,e)=>(0,r.jsx)(N,{producto:a},e))}),(0,r.jsx)("div",{className:p().fooder}),(0,r.jsx)(l.u_,{title:"Ejecutar Acci\xf3n",message:"\xbfQuieres ejecutar la acci\xf3n?, Se retirara la cantida de productos del inventario y no se podra deshacer la acci\xf3n",show:x,handleClose:()=>{m(!1)},handleAccept:()=>{v(!0),T()}}),(0,r.jsx)(g.Z,{show:j})]})},H=o(8657),P=o.n(H),S=function(a){let{entregas:e}=a;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:P().header,children:(0,r.jsx)("h3",{children:"Historial de Entregas"})}),(0,r.jsxs)("div",{className:P().titulo,children:[(0,r.jsx)("h4",{className:P().municipio,children:"Municipio"}),(0,r.jsx)("h4",{className:P().entregado,children:"Entregado"}),(0,r.jsx)("h4",{className:P().estado,children:"Estado"}),(0,r.jsx)("h4",{className:P().monto,children:"Monto"}),(0,r.jsx)("h4",{className:P().pendiente,children:"Pago pendiente"}),(0,r.jsx)("h4",{className:P().comision,children:"Comisi\xf3n In"}),(0,r.jsx)("h4",{className:P().comision,children:"Comisi\xf3n Ex"}),(0,r.jsx)("h4",{className:P().totalfunjal,children:"Total"})]}),e?(0,r.jsx)(r.Fragment,{children:e.map((a,e)=>(0,r.jsxs)("div",{className:P().container,children:[(0,r.jsxs)("div",{className:P().municipio,children:[a.cli_municipio,", ",a.cli_estado]}),(0,r.jsx)("div",{className:P().entregado,children:(0,u.ji)(a.en_dia_entrega)}),(0,r.jsx)("div",{className:P().estado,children:a.deu_estado}),(0,r.jsx)("div",{className:P().monto,children:(0,u.uf)(a.deu_deuda)}),(0,r.jsx)("div",{className:P().pendiente,children:(0,u.uf)(a.deu_deuda_pendiente)}),(0,r.jsx)("div",{className:P().comision,children:(0,u.uf)(a.deu_comision_funjal)}),(0,r.jsx)("div",{className:P().comision,children:(0,u.uf)(a.deu_comision_enlace)}),(0,r.jsx)("div",{className:P().totalfunjal,children:(0,u.uf)(a.deu_deuda-a.deu_comision_funjal-a.deu_comision_enlace)})]},e))}):(0,r.jsx)("div",{className:P().container,children:"Auno no hay datos"}),(0,r.jsx)("div",{className:P().fooder})]})},E=o(605),w=o(9376),C=function(){let{data:a,status:e}=(0,E.useSession)(),o=(0,w.useRouter)(),[s,d]=(0,i.useState)(!0),[u,h]=(0,i.useState)(null),[x,j]=(0,i.useState)([]),[p,v]=(0,i.useState)(0),[b,f]=(0,i.useState)(15),[g,N]=(0,i.useState)(null),[H,P]=(0,i.useState)(null),[C,y]=(0,i.useState)(null),[L,k]=(0,i.useState)(!0),[O,z]=(0,i.useState)(!1),[A,D]=(0,i.useState)(!1),F=()=>!(x.length-p*b<10);(0,i.useEffect)(()=>{"Administrador"===a.user.role?A?fetch("/api/historial/entregas?page=".concat(p+1,"&limit=").concat(b).concat(g?"&filter=".concat(g):"").concat(H&&!C?"&day=".concat(H):"").concat(C&&!H?"&month=".concat(C):"")).then(a=>{if(!a.ok)throw Error("Error al cargar el historial");return a.json()}).then(a=>{j([...x,...a]),d(!1)}).catch(a=>{h(a),d(!1)}):fetch("/api/historial/global?page=".concat(p+1,"&limit=").concat(b).concat(g?"&filter=".concat(g):"").concat(H&&!C?"&day=".concat(H):"").concat(C&&!H?"&month=".concat(C):"")).then(a=>{if(!a.ok)throw Error("Error al cargar el historial");return a.json()}).then(a=>{j([...x,...a]),d(!1)}).catch(a=>{h(a),d(!1)}):o.push("/")},[p,g,H,C,o,A,L]),(0,i.useEffect)(()=>{let a=()=>{let a=window.scrollY||document.documentElement.scrollTop,e=document.documentElement.scrollHeight;a+(window.innerHeight||document.documentElement.clientHeight)>=e-5&&F()&&L&&v(p+1)};return window.addEventListener("scroll",a),()=>window.removeEventListener("scroll",a)},[F]);let Q=()=>{};return s?(0,r.jsx)("div",{className:t().loadingScreen,children:(0,r.jsx)(c.Z,{})}):u?(0,r.jsx)("div",{className:t().error,children:(0,r.jsxs)("div",{className:t().errorContent,children:[(0,r.jsx)(_(),{className:t().textIcon,name:"cloud-offline-outline"}),(0,r.jsx)("p",{className:t().textError,children:u.message})]})}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:t().navegacion,children:(0,r.jsxs)("h4",{children:[(0,r.jsx)(n.default,{href:"/Historial",className:t().link,children:"Historial"})," ","\\"," "]})}),(0,r.jsxs)("div",{className:t().herramientas,children:[(0,r.jsx)(l.zx,{text:"Movimientos de inventario",type:L?"":"cancelar",onPress:()=>{j([]),v(0),P(null),y(null),N(null),k(!0),D(!1),z(!1)}}),(0,r.jsx)(l.zx,{text:"Productos",type:O?"":"cancelar",onPress:()=>{k(!1),D(!1),z(!0)}}),(0,r.jsx)(l.zx,{text:"Historial de entregas",type:A?"":"cancelar",onPress:()=>{j([]),v(0),P(null),y(null),N(null),k(!1),D(!0),z(!1),Q()}})]}),L&&(0,r.jsxs)("div",{className:t().herramientas,children:[(0,r.jsx)("label",{children:"filtrar por: "}),(0,r.jsx)(l.zx,{text:"Entradas",type:"entrada"==g?"":"cancelar",onPress:()=>{"entrada"==g?(v(0),j([]),N(null)):(v(0),j([]),N("entrada"))}}),(0,r.jsx)(l.zx,{text:"Salidas",type:"salida"==g?"":"cancelar",onPress:()=>{"salida"==g?(v(0),j([]),N(null)):(v(0),j([]),N("salida"))}}),(0,r.jsx)(l.zx,{text:"Esta semana",type:H?"":"cancelar",onPress:()=>{if(y(null),H)v(0),j([]),P(null);else{let a=new Date;v(0),j([]),P(a.toISOString().split("T")[0])}}}),(0,r.jsx)(l.zx,{text:"Este mes",type:C?"":"cancelar",onPress:()=>{if(P(null),C)v(0),j([]),y(null);else{let a=new Date;v(0),j([]),y(a.toISOString().split("T")[0])}}})]}),A&&(0,r.jsxs)("div",{className:t().herramientas,children:[(0,r.jsx)("label",{children:"filtrar por: "}),(0,r.jsx)(l.zx,{text:"Saldadas",type:"saldada"==g?"":"cancelar",onPress:()=>{"saldada"==g?(v(0),j([]),N(null)):(v(0),j([]),N("saldada"))}}),(0,r.jsx)(l.zx,{text:"pendientes",type:"pendiente"==g?"":"cancelar",onPress:()=>{"pendiente"==g?(v(0),j([]),N(null)):(v(0),j([]),N("pendiente"))}})]}),(0,r.jsxs)("div",{className:t().contenido,children:[L&&(0,r.jsx)(m,{historial:x}),O&&(0,r.jsx)(T,{}),A&&(0,r.jsx)(S,{entregas:x})]})]})}},8072:function(a,e,o){"use strict";o.d(e,{Z:function(){return n}});var r=o(7437),i=o(8116),s=o(5172),t=o.n(s);function n(){return(0,r.jsx)("div",{className:t().container,children:(0,r.jsx)(i.Z,{})})}},9172:function(a,e,o){"use strict";var r=o(7437),i=o(6660),s=o.n(i);e.Z=function(a){let{show:e}=a;return(0,r.jsx)("div",{className:"".concat(s().modal," ").concat(e?s().show:""),children:(0,r.jsxs)("div",{className:s().contenedor,children:[(0,r.jsx)("div",{className:s().cuadrado1}),(0,r.jsx)("div",{className:s().cuadrado2})]})})}},8116:function(a,e,o){"use strict";o.d(e,{Z:function(){return t}});var r=o(7437);o(2265);var i=o(6065),s=o.n(i);function t(){return(0,r.jsxs)("div",{className:s().contenedor,children:[(0,r.jsx)("div",{className:s().cuadrado1}),(0,r.jsx)("div",{className:s().cuadrado2})]})}},3431:function(a){a.exports={navegacion:"page_navegacion__n6vZH",link:"page_link__5ApgB",contenido:"page_contenido__Uc00y",herramientas:"page_herramientas__QP2XF",busqueda:"page_busqueda__kxTOc",filtro:"page_filtro__mGu8D",ajustarfiltro:"page_ajustarfiltro__rj5Il",banner:"page_banner__zxAlf",loadingScreen:"page_loadingScreen__63f1p",error:"page_error__BYpsi",textIcon:"page_textIcon__f39oF",textError:"page_textError__7L1Yt",errorContent:"page_errorContent__93LUH"}},5172:function(a){a.exports={container:"loading_container__m1vbF"}},56:function(a){a.exports={header:"TablaHistorial_header__twSkW",container:"TablaHistorial_container__uU65Q",fooder:"TablaHistorial_fooder__U5sxO",totalPrecio:"TablaHistorial_totalPrecio__ES8Ph",totalTexto:"TablaHistorial_totalTexto__NiLwV",totalCantidad:"TablaHistorial_totalCantidad__r5OYt",titulo:"TablaHistorial_titulo__8Q03l",texto:"TablaHistorial_texto__T6O0M",nombre:"TablaHistorial_nombre__Nag_L",cantidad:"TablaHistorial_cantidad___FUQe",precio:"TablaHistorial_precio__rPm65",estado:"TablaHistorial_estado__9dobj",motivo:"TablaHistorial_motivo___0bmr",hora:"TablaHistorial_hora__6wur0",fecha:"TablaHistorial_fecha__pQbdf",circulo:"TablaHistorial_circulo__fbBSB",verde:"TablaHistorial_verde__sU9g4",amarillo:"TablaHistorial_amarillo__Je3PX",rojo:"TablaHistorial_rojo__3Y56s"}},8657:function(a){a.exports={header:"TablaHistorialEntregas_header__uYtwQ",container:"TablaHistorialEntregas_container__ll8gz",fooder:"TablaHistorialEntregas_fooder__x3106",titulo:"TablaHistorialEntregas_titulo__NJDPJ",texto:"TablaHistorialEntregas_texto__9NBW7",municipio:"TablaHistorialEntregas_municipio__ssJ__",pendiente:"TablaHistorialEntregas_pendiente__RuXvk",estado:"TablaHistorialEntregas_estado__EXo_f",monto:"TablaHistorialEntregas_monto__lPZto",entregado:"TablaHistorialEntregas_entregado__fcChF",comision:"TablaHistorialEntregas_comision__NROxY",totalfunjal:"TablaHistorialEntregas_totalfunjal__lcrnW",circulo:"TablaHistorialEntregas_circulo__x_41r",verde:"TablaHistorialEntregas_verde___zNOq",amarillo:"TablaHistorialEntregas_amarillo__eASsP",rojo:"TablaHistorialEntregas_rojo__RqTkV"}},6188:function(a){a.exports={herramientas:"TablaHistorialProductos_herramientas__ORH2e",input:"TablaHistorialProductos_input__xKbxg",select:"TablaHistorialProductos_select__tKRF2",validar:"TablaHistorialProductos_validar__OgCyK",validarTexto:"TablaHistorialProductos_validarTexto__8Qzl3",header:"TablaHistorialProductos_header__oGRm2",container:"TablaHistorialProductos_container__3NCnB",desplegado:"TablaHistorialProductos_desplegado__QxvCN",contenedorHistorial:"TablaHistorialProductos_contenedorHistorial__H2nTt",fooder:"TablaHistorialProductos_fooder__nbpOt",button:"TablaHistorialProductos_button__OT50a",disabled:"TablaHistorialProductos_disabled__fcA45",enabled:"TablaHistorialProductos_enabled__18nwa",totalPrecio:"TablaHistorialProductos_totalPrecio__A3w2s",totalTexto:"TablaHistorialProductos_totalTexto__5jhTH",totalCantidad:"TablaHistorialProductos_totalCantidad__G2TLB",titulo:"TablaHistorialProductos_titulo__r3BBL",texto:"TablaHistorialProductos_texto__HM14w",nombre:"TablaHistorialProductos_nombre__mZlyA",cantidad:"TablaHistorialProductos_cantidad__Sxm_a",estado:"TablaHistorialProductos_estado__ACGrx",precio:"TablaHistorialProductos_precio__oROFt",participacion:"TablaHistorialProductos_participacion__ziWKN",verde:"TablaHistorialProductos_verde__JDL4x",rojo:"TablaHistorialProductos_rojo__6ghjL"}},8224:function(a){a.exports={header:"TablaProveedores_header__jZtvu",container:"TablaProveedores_container__dVzTf",desplegado:"TablaProveedores_desplegado__cy0xJ",fooder:"TablaProveedores_fooder___4lBq",titulo:"TablaProveedores_titulo__RAl71",texto:"TablaProveedores_texto__c0viP",nombre:"TablaProveedores_nombre__HS_Vs",telefono:"TablaProveedores_telefono__igSaV",direccion:"TablaProveedores_direccion___Z8ef",rfc:"TablaProveedores_rfc__o_7gh"}},6660:function(a){a.exports={cuadrado1:"LoadingData_cuadrado1__x1QGj",cuadrado2:"LoadingData_cuadrado2__hOwqp",moverCuadrado1:"LoadingData_moverCuadrado1__vWwXS",moverCuadrado2:"LoadingData_moverCuadrado2__gm3Qs",modal:"LoadingData_modal__Rqj2p",show:"LoadingData_show__jLq8l"}},6065:function(a){a.exports={cuadrado1:"LoadingScreen_cuadrado1__7A200",cuadrado2:"LoadingScreen_cuadrado2__NNxpH",moverCuadrado1:"LoadingScreen_moverCuadrado1__8i1jV",moverCuadrado2:"LoadingScreen_moverCuadrado2__pz35P"}}},function(a){a.O(0,[850,7123,1316,8153,6307,7648,4868,2971,2117,1744],function(){return a(a.s=4112)}),_N_E=a.O()}]);