(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3713],{9689:function(e,a,t){Promise.resolve().then(t.bind(t,9902))},9902:function(e,a,t){"use strict";t.r(a);var s=t(7437),o=t(4868),n=t(5988),r=t.n(n),d=t(8116),l=t(8999),i=t.n(l),c=t(7648),u=t(9376),_=t(2265),p=t(6806),h=t(6812),g=t(5171),x=t(7408),m=t(8662),j=t(244),f=t(8723),v=t(3730),S=t(5941),N=t(605);a.default=function(){let e=(0,u.useRouter)(),a=(0,u.useSearchParams)().get("id"),{data:t,status:n}=(0,N.useSession)(),[l,b]=(0,_.useState)(!0),[C,P]=(0,_.useState)(""),[y,E]=(0,_.useState)(!1),[k,Z]=(0,_.useState)(!1),[z,w]=(0,_.useState)(!1),[D,I]=(0,_.useState)(!1),[T,A]=(0,_.useState)(!1),[F,q]=(0,_.useState)(!0),[O,V]=(0,_.useState)(!1),[J,R]=(0,_.useState)(!0),[H,L]=(0,_.useState)(!1),[B,M]=(0,_.useState)(!1),[G,K]=(0,_.useState)(null),[Q,U]=(0,_.useState)(0),[Y,W]=(0,_.useState)(0),[X,$]=(0,_.useState)(0),[ee,ea]=(0,_.useState)([]),[et,es]=(0,_.useState)(!1),[eo,en]=(0,_.useState)(0),[er,ed]=(0,_.useState)(""),[el,ei]=(0,_.useState)(""),[ec,eu]=(0,_.useState)(""),[e_,ep]=(0,_.useState)([]),[eh,eg]=(0,_.useState)([]),[ex,em]=(0,_.useState)([]),[ej,ef]=(0,_.useState)([]),[ev,eS]=(0,_.useState)([]),[eN,eb]=(0,_.useState)([]),[eC,eP]=(0,_.useState)([]),[ey,eE]=(0,_.useState)([]),[ek,eZ]=(0,_.useState)([]),[ez,ew]=(0,_.useState)([]),[eD,eI]=(0,_.useState)([]),[eT,eA]=(0,_.useState)([]),[eF,eq]=(0,_.useState)([]),[eO,eV]=(0,_.useState)([]),[eJ,eR]=(0,_.useState)([]),[eH,eL]=(0,_.useState)([]);(0,_.useEffect)(()=>{"Administrador"===t.user.role||"Encargado"===t.user.role?fetch("/api/entregas/obtener/entrega/".concat(a)).then(e=>{if(!e.ok)throw Error("Error en la llamada");return e.json()}).then(a=>{if("finalizada"===a.entrega.en_estado){if(ep(a.entrega),eg(a.cliente),em(a.encargado),ef(a.empleados),eS(a.vehiculos),0!=a.productos.length){let e=a.productos.filter(e=>"en entrega"==e.en_produc_estado),t=a.productos.filter(e=>"devuelto"==e.en_produc_estado);eb(e),eP(t)}if(0!=a.paquetes.length){let e=a.paquetes.filter(e=>"en entrega"==e.en_pa_estado),t=a.paquetes.filter(e=>"devuelto"==e.en_pa_estado);eZ(e),ew(t)}if(eE(a.productos_paquete),0!=a.producto_estado.length){let e=a.producto_estado.filter(e=>"cargado"==e.en_es_produc_estado||"recibido"==e.en_es_produc_estado),t=a.producto_estado.filter(e=>"da\xf1ado"==e.en_es_produc_estado),s=a.producto_estado.filter(e=>"extraviado"==e.en_es_produc_estado),o=a.producto_estado.filter(e=>"no encontrado"==e.en_es_produc_estado),n=a.producto_estado.filter(e=>"devuelto"==e.en_es_produc_estado),r=a.producto_estado.filter(e=>"vendido individual"==e.en_es_produc_estado);eI(e),eA(t),eq(s),eV(o),eR(n),eL(r)}b(!1)}else e.push("/entregas")}).catch(e=>{P(e)}):e.push("/")},[a,e]),(0,_.useEffect)(()=>{fetch("/api/entregas/deudas/".concat(a)).then(e=>{if(!e.ok)throw Error("Response is not ok");return e.json()}).then(e=>{console.log(e),K(e.deu_id),U(e.deu_deuda),$(e.deu_abono),W(e.deu_deuda_pendiente)}).catch(e=>{P(e)})},[a,y]),(0,_.useEffect)(()=>{G&&fetch("/api/entregas/deudas/pagos/".concat(G)).then(e=>{if(!e.ok)throw Error("Response is not ok");return e.json()}).then(e=>{console.log(e),ea(e)}).catch(e=>{P(e)})},[G,y]);let eB=()=>{console.log("monto",eo),console.log("fecha",er),console.log("metodo",el),console.log("descripcion",ec),eo>0&&""!=er&&""!=el&&""!=ec?w(!0):I(!0)},eM=async()=>{try{if(!(await fetch("/api/entregas/deudas/".concat(a),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({deu_estado:Number(Y)-Number(eo)<=0?"saldada":"pendiente",deu_deuda_pendiente:Number(Y)-Number(eo)<=0?0:Number(Y)-Number(eo)})})).ok)throw Error("Response is not ok");(await fetch("/api/entregas/deudas/pagos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deu_id:G,pag_monto:eo,pag_metodo:el,pag_desc:ec,pag_fecha_transac:er})})).ok&&(E(!y),es(!1),en(0),ed(""),ei(""),eu("")),w(!1)}catch(e){P(e)}};return l?(0,s.jsx)("div",{className:r().loadingScreen,children:(0,s.jsx)(d.Z,{})}):C?(0,s.jsx)("div",{className:r().error,children:(0,s.jsxs)("div",{className:r().errorContent,children:[(0,s.jsx)(i(),{className:r().textIcon,name:"cloud-offline-outline"}),(0,s.jsx)("p",{className:r().textError,children:"No hay Conexi\xf3n"})]})}):(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:r().navegacion,children:(0,s.jsxs)("h4",{children:[(0,s.jsx)(c.default,{href:"/entregas",className:r().link,children:"Entregas"})," ","\\ Finalizada \\"," ",0!=e_.length?"".concat(eh.cli_municipio,", ").concat(eh.cli_estado,"."):"Cargando..."]})}),(0,s.jsx)("div",{className:r().herramientas,children:0!=e_.length&&(0,s.jsxs)("p",{children:["Entrega realizada el d\xeda"," ",(0,s.jsx)("b",{children:(0,p.ji)(e_.en_dia_entrega)})," a las"," ",(0,s.jsxs)("b",{children:[(0,p.ln)(e_.en_hora_entrega)," hrs"]})]})}),(0,s.jsxs)("div",{className:r().contenido,children:[(0,s.jsxs)("div",{className:r().subContenedor1,children:[(0,s.jsxs)("div",{className:r().herramientasContenido,children:[(0,s.jsx)(o.zx,{text:"Entrgados",type:J?"":"cancelar",onPress:()=>{R(!0),L(!1),M(!1)}}),0!=eH.length&&(0,s.jsx)(o.zx,{text:"Venta Individual",type:H?"":"cancelar",onPress:()=>{R(!1),L(!0),M(!1)}}),(0,s.jsx)(o.zx,{text:"Contenido",type:B?"":"cancelar",onPress:()=>{R(!1),L(!1),M(!0)}})]}),J&&(0,s.jsx)(j.Z,{paquetes:ek,productos:eN,totalAPagar:()=>{}}),H&&(0,s.jsx)(f.Z,{listaVentasIndividuales:eH}),B&&(0,s.jsxs)("div",{children:[(0,s.jsx)(S.Z,{productos:eD}),0!=eJ.length&&(0,s.jsx)(v.Z,{titulo:"Productos Devueltos",listaProductos:eJ}),0!=eT.length&&(0,s.jsx)(v.Z,{titulo:"Productos da\xf1ados",listaProductos:eT,alterButton:"repuesto",onDelete:e=>{eliminarDeListaDaÃ±ado(e),setIsSaved(!1)}}),0!=eF.length&&(0,s.jsx)(v.Z,{titulo:"Productos extraviados",listaProductos:eF,alterButton:"repuesto",onDelete:e=>{eliminarDeListaExtraviado(e),setIsSaved(!1)}}),0!=eO.length&&(0,s.jsx)(v.Z,{titulo:"Productos no encontrados",listaProductos:eO,alterButton:"repuesto",onDelete:e=>{eliminarDeListaNoEncontrado(e),setIsSaved(!1)}})]})]}),(0,s.jsxs)("div",{className:r().subContenedor2,children:[(0,s.jsxs)("div",{className:r().herramientasInfo,children:[(0,s.jsx)(o.zx,{text:T?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"Visualizar"}),(0,s.jsx)(i(),{className:r().icon,name:"eye-outline"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"Ocultar"}),(0,s.jsx)(i(),{className:r().icon,name:"eye-off-outline"})]}),type:T?"contenido-light":"contenido-dark",onPress:()=>A(!T)}),(0,s.jsx)(o.zx,{text:"informaci\xf3n",type:F?"":"cancelar",onPress:()=>{q(!0),V(!1)}}),(0,s.jsx)(o.zx,{text:"Pagos",type:O?"":"cancelar",onPress:()=>{q(!1),V(!0)}})]}),!T&&(0,s.jsxs)(s.Fragment,{children:[F&&(0,s.jsxs)("div",{className:r().scrollable,children:[(0,s.jsx)(h.Z,{municipio:eh}),(0,s.jsx)(g.Z,{empleados:ej,encargado:ex}),(0,s.jsx)(x.Z,{vehiculos:ev})]}),O&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:r().menuPagos,children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("b",{children:"Deuda: "}),(0,p.uf)(Q)]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("b",{children:"Abono: "}),(0,p.uf)(X)]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("b",{children:"Saldo Restante:"})," ",k?"Cuenta saldada":(0,p.uf)((()=>{let e=Q-X-ee.reduce((e,a)=>e+a.pag_monto,0);return e<=0&&(Z(!0),console.log("deuda saldada")),e})())]})]}),!k&&(0,s.jsx)(o.zx,{text:et?"Contraer":"Nuevo pago",type:et?"":"cancelar",onPress:()=>es(!et)}),et&&(0,s.jsxs)("div",{className:r().formulario,children:[(0,s.jsxs)("form",{children:[(0,s.jsx)("label",{children:"Monto:"}),(0,s.jsx)("input",{type:"number",min:0,className:r().input,value:eo,onChange:e=>en(e.target.value)}),(0,s.jsx)("label",{children:"Fecha:"}),(0,s.jsx)("input",{type:"date",className:r().date,value:er,onChange:e=>ed(e.target.value)}),(0,s.jsx)("label",{children:"M\xe9todo de pago:"}),(0,s.jsxs)("select",{className:r().select,value:el,onChange:e=>ei(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"-Seleccione m\xe9todo-"}),(0,s.jsx)("option",{value:"efectivo",children:"Efectivo"}),(0,s.jsx)("option",{value:"transferencia",children:"Transferencia"})]}),(0,s.jsxs)("section",{className:r().sectionTextarea,children:[(0,s.jsx)("label",{children:"Comentario:"}),(0,s.jsx)("textarea",{className:r().textarea,value:ec,onChange:e=>eu(e.target.value)})]})]}),(0,s.jsx)(o.zx,{text:"Guardar",type:"cancelar",onPress:()=>eB()})]})]}),0!=ee.length?(0,s.jsx)("div",{className:r().scrollablePagos,children:ee.map(e=>(0,s.jsx)(m.Z,{pago:e},e.pag_id))}):(0,s.jsx)("div",{className:r().errorContent,children:(0,s.jsx)("p",{className:r().textNoFound,children:"No hay pagos"})})]})]})]})]}),(0,s.jsx)(o.u_,{title:"Nuevo Pago",show:z,message:"\xbfDesea agregar el nuevo pago?",handleAccept:()=>{eM()},handleClose:()=>w(!1)}),(0,s.jsx)(o.bZ,{title:"Datos del pago invalidos",message:"Por favor, complete todos los campos o introdusca un monto valido",show:D,handleAccept:()=>I(!1)})]})}},5988:function(e){e.exports={navegacion:"page_navegacion__0Zzvg",link:"page_link__CkflS",herramientas:"page_herramientas__4Y0JM",contenido:"page_contenido__7HhkT",herramientasInfo:"page_herramientasInfo__Owinv",icon:"page_icon__eqP_E",herramientasContenido:"page_herramientasContenido__4xgpw",select:"page_select__7qdmA",option:"page_option__zjopT",inputNumberContainer:"page_inputNumberContainer__2pHtA",inputNumber:"page_inputNumber__pgO5s",subContenedor1:"page_subContenedor1__cNi3b",subContenedor2:"page_subContenedor2__TVyHw",scrollable:"page_scrollable__sQ9cg",scrollablePagos:"page_scrollablePagos__m485e",loadingScreen:"page_loadingScreen__vE_xn",error:"page_error__VKyhG",textIcon:"page_textIcon___hv_0",textNoFound:"page_textNoFound__FEVdy",textError:"page_textError__vfJ0u",errorContent:"page_errorContent__LsHAb",menuPagos:"page_menuPagos__c2Zs1",formulario:"page_formulario__Zm4jp",input:"page_input__AZlcr",date:"page_date__C1m7V",sectionTextarea:"page_sectionTextarea__fukE7",textarea:"page_textarea__ZpqJd"}}},function(e){e.O(0,[7123,1316,8153,6307,7648,4868,3875,2971,2117,1744],function(){return e(e.s=9689)}),_N_E=e.O()}]);