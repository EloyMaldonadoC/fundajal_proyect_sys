(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1947],{2564:function(e,a,t){Promise.resolve().then(t.bind(t,5126))},5126:function(e,a,t){"use strict";t.r(a);var n=t(7437),s=t(2265),r=t(1801),o=t.n(r),i=t(7648),l=t(9376),u=t(957),d=t(4868),c=t(244),p=t(605),_=t(9172);a.default=function(){let{data:e,status:a}=(0,p.useSession)(),t=(0,l.useRouter)(),[r,h]=(0,s.useState)(!1),[m,g]=(0,s.useState)(!1),[f,b]=(0,s.useState)(0),[x,j]=(0,s.useState)(0),[S,v]=(0,s.useState)([]),[N,y]=(0,s.useState)(!1),[E,w]=(0,s.useState)([]),[C,k]=(0,s.useState)(!1),[P,T]=(0,s.useState)(null),[O,q]=(0,s.useState)(!1),[A,D]=(0,s.useState)(null),[J,I]=(0,s.useState)(!1),[L,z]=(0,s.useState)(null),[F,Q]=(0,s.useState)(null),[R,U]=(0,s.useState)(0),[Z,M]=(0,s.useState)(0),[V,B]=(0,s.useState)(0),[H,K]=(0,s.useState)(0),[X,Y]=(0,s.useState)(0),[G,W]=(0,s.useState)(!0),[$,ee]=(0,s.useState)(!1),[ea,et]=(0,s.useState)(!1),[en,es]=(0,s.useState)(""),[er,eo]=(0,s.useState)(""),ei=()=>{z(Math.floor(1e6+9e7*Math.random()))};(0,s.useEffect)(()=>{"Administrador"===e.user.role||"Encargado"===e.user.role?(ei(),fetch("/api/datetime/date").then(e=>{if(!e.ok)throw Error("Response is not ok");return e.json()}).then(e=>{Q(e.fecha_actual)})):t.push("/")},[t]),(0,s.useEffect)(()=>{if(0!=S.length){let e=0;for(let a=0;a<S.length;a++)e+=S[a].en_produc_cantidad*(S[a].produc_precio_venta+S[a].en_produc_oferta);M(e)}else M(0)},[S]),(0,s.useEffect)(()=>{if(0!=E.length){let e=0;for(let a=0;a<E.length;a++)e+=E[a].en_pa_cantidad*(E[a].pa_precio+E[a].en_pa_desc);B(e)}else B(0)},[E]),(0,s.useEffect)(()=>{if(0!=S.length){let e=0,a=0;for(let t=0;t<S.length;t++)e+=S[t].produc_parti_fun*S[t].en_produc_cantidad,a+=S[t].produc_parti_enlace*S[t].en_produc_cantidad;for(let t=0;t<E.length;t++)e+=E[t].pa_comision*E[t].en_pa_cantidad,a+=E[t].pa_comision*E[t].en_pa_cantidad;K(e),Y(a)}},[Z,E,S]);let el=()=>{null==A?I(!0):I(!1),null==P?q(!0):q(!1),null!=A&&null!=P&&(R<Number(Z)+Number(V)||0==R)?h(!0):(et(!0),es("Error de validaci\xf3n"),eo("Debe seleccionar un encargado, un municipio y el abono debe ser menor o igual a la deuda"))},eu=async()=>{try{if(!(await fetch("/api/entregas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({en_id:L,emp_id:A,cli_id:P,en_incremento_producto:Number(f),en_incremento_paquete:Number(x),en_dia_pedido:F,en_dia_entrega:null,en_hora_salida:null,en_hora_entrega:null,en_estado:"por confirmar"})})).ok)throw Error("Network response was not ok");if(null!=S&&0!=S.length&&await fetch("/api/entregas/productos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)}).then(e=>{if(!e.ok)throw Error("Error al intentar agregar los productos");return e.json()}),null!=E&&0!=E.length){let e=E.map(e=>({...e,en_pa_desc:x}));console.log(e),await fetch("/api/entregas/paquetes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw Error("Error al intentar agregar los paquetes")})}if(!(await fetch("/api/entregas/deudas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({en_id:L,deu_abono:R,deu_estado:"a procesar",deu_deuda:Number(Z)+Number(V),deu_deuda_pendiente:Number(Z)+Number(V)-Number(R),deu_comision_funjal:Number(H),deu_comision_enlace:Number(X)})})).ok)throw Error("Network response was not ok")}catch(e){console.log(e.message)}t.push("/entregas")};return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:o().navegacion,children:(0,n.jsxs)("h4",{children:[(0,n.jsx)(i.default,{href:"/entregas",className:o().link,children:"Entregas"})," ","\\ Nuevo"]})}),(0,n.jsxs)("div",{className:o().herramientas,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Incremento para los productos: "}),(0,n.jsx)("input",{type:"number",className:o().input,min:0,value:f,onChange:e=>{b(e.target.value),W(!0),ee(!1)}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Incremento para los paquetes: "}),(0,n.jsx)("input",{type:"number",className:o().input,min:0,value:x,onChange:e=>{j(e.target.value),W(!0),ee(!1)}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"Abono: "}),(0,n.jsx)("input",{type:"number",className:o().input,min:0,value:R,onChange:e=>{U(e.target.value)}})]}),(0,n.jsx)("div",{children:(0,n.jsxs)("p",{children:["Deuda:"," ",(0,n.jsx)("b",{children:(Number(Z)+Number(V)-Number(R)).toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0})})]})}),(0,n.jsx)(d.zx,{text:"Terminado",type:"cancelar",onPress:()=>{el()}})]}),(0,n.jsxs)("div",{className:o().contenido,children:[(0,n.jsxs)("div",{className:o().subContenedor1,children:[(0,n.jsxs)("div",{className:o().herramientasContenido,children:[(0,n.jsx)(d.zx,{text:"Seleccionar Productos",type:G?"":"cancelar",onPress:()=>{W(!0),ee(!1)}}),(0,n.jsx)(d.zx,{text:"Total Lista de Productos",type:$?"":"cancelar",onPress:()=>{W(!1),ee(!0)}})]}),G&&(0,n.jsxs)("div",{className:o().scrollable,children:[(0,n.jsx)(u.a3,{listaProductos:S,modificarLista:e=>{v(e)},idEntrega:L,modificador:f,validar:N}),(0,n.jsx)(u.XD,{listaPaquetes:E,modificarLista:e=>{w(e)},idEntrega:L,modificador:x,validar:C})]}),$&&(0,n.jsx)("div",{className:o().scrollable,children:(0,n.jsx)(c.Z,{productos:S,paquetes:E,totalAPagar:()=>{}})})]}),(0,n.jsxs)("div",{className:o().subContenedor2,children:[(0,n.jsx)(u.Bj,{datosCliente:e=>{T(e)},validar:O}),(0,n.jsx)(u.Jl,{enlace:e=>{D(e)},validar:J})]})]}),(0,n.jsx)(d.u_,{show:r,title:"Agregar Nueva Entrega",message:"Se agregara una nueva entrega con los datos previamente selecci\xf3nados",handleAccept:()=>{g(!0),eu()},handleClose:()=>h(!1)}),(0,n.jsx)(d.bZ,{show:ea,handleAccept:()=>et(!1),title:en,message:er}),(0,n.jsx)(_.Z,{show:m})]})}},1801:function(e){e.exports={navegacion:"page_navegacion__v9Q_S",link:"page_link__KUA3H",contenido:"page_contenido__R4rvm",herramientasContenido:"page_herramientasContenido___ntvc",herramientas:"page_herramientas__wPxYV",subContenedor1:"page_subContenedor1__gexTs",subContenedor2:"page_subContenedor2__EDIIq",input:"page_input__VtQq5",scrollable:"page_scrollable__w7Q0F"}}},function(e){e.O(0,[8445,7123,1316,8153,6307,7648,4868,304,2971,2117,1744],function(){return e(e.s=2564)}),_N_E=e.O()}]);